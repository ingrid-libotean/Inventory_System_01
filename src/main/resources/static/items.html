<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Warehouse Inventory</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .quantity-badge { font-size: 0.9em; padding: 5px 10px; border-radius: 10px; }
        .low-stock { background-color: #ffcccc; color: #a00; }
        .good-stock { background-color: #ccffcc; color: #060; }
    </style>
</head>
<body class="p-4 bg-light">

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 id="pageTitle">ðŸ“¦ Loading...</h3>

        <a href="warehouses.html" class="btn btn-secondary">Back to Warehouses</a>
    </div>

    <div class="card p-3 mb-4 shadow-sm">
        <h5>Add New Item</h5>
        <div class="row g-2">
            <div class="col-md-4">
                <input type="text" id="itemName" class="form-control" placeholder="Item Name (e.g. Milk)">
            </div>
            <div class="col-md-2">
                <input type="number" id="itemQty" class="form-control" placeholder="Qty">
            </div>
            <div class="col-md-2">
                <input type="number" id="itemPrice" class="form-control" placeholder="Price ($)">
            </div>
            <div class="col-md-2">
                <button class="btn btn-success w-100" onclick="addItem()">+ Add Item</button>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover">
                <thead class="table-dark">
                <tr>
                    <th>Name</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="itemsTable">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // --- GANDIREA LOGICA (EXPLICATA MAI JOS) ---

    // 1. Citim URL-ul curent (ex: items.html?id=5&name=Garage)
    const urlParams = new URLSearchParams(window.location.search);

    // 2. Extragem parametrii
    const warehouseId = urlParams.get('id');
    const warehouseName = urlParams.get('name'); // Aici prindem numele trimis

    // 3. Validare si Afisare
    if (!warehouseId) {
        alert("No warehouse selected!");
        window.location.href = "warehouses.html";
    }

    // AICI SETAM TITLUL DINAMIC
    if (warehouseName) {
        document.getElementById("pageTitle").innerText = `ðŸ“¦ ${warehouseName} - Inventory Items`;
        document.title = `${warehouseName} Inventory`; // Schimba si titlul tab-ului din browser
    } else {
        document.getElementById("pageTitle").innerText = `ðŸ“¦ Inventory Items`;
    }

    const API_URL = "http://localhost:8080/api/items";

    // ÃŽncÄƒrcare iniÈ›ialÄƒ
    loadItems();

    async function loadItems() {
        const response = await fetch(`${API_URL}/warehouse/${warehouseId}`);
        const items = await response.json();

        const tbody = document.getElementById("itemsTable");
        tbody.innerHTML = "";

        if (items.length === 0) {
            tbody.innerHTML = "<tr><td colspan='5' class='text-center'>No items yet. Add some!</td></tr>";
            return;
        }

        items.forEach(item => {
            const stockClass = item.currentQuantity < 5 ? "low-stock" : "good-stock";

            const row = `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.currentQuantity}</td>
                    <td>$${item.price}</td>
                    <td><span class="quantity-badge ${stockClass}">${item.currentQuantity < 5 ? 'Low Stock' : 'In Stock'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem(${item.item_id})">Delete</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    async function addItem() {
        const name = document.getElementById("itemName").value;
        const qty = document.getElementById("itemQty").value;
        const price = document.getElementById("itemPrice").value;

        if (!name || !qty) return alert("Fill in name and quantity!");

        const newItem = {
            warehouseId: warehouseId,
            name: name,
            currentQuantity: parseFloat(qty),
            price: parseFloat(price) || 0,
            weight: 0,
            volume: 0,
            userId: 0
        };

        await fetch(`${API_URL}/add`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(newItem)
        });

        document.getElementById("itemName").value = "";
        document.getElementById("itemQty").value = "";
        document.getElementById("itemPrice").value = "";
        loadItems();
    }

    async function deleteItem(id) {
        if(!confirm("Delete item?")) return;
        await fetch(`${API_URL}/delete/${id}`, { method: "DELETE" });
        loadItems();
    }
</script>

</body>
</html>